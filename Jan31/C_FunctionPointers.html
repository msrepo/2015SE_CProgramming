<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>C/FunctionPointers</title>
<link rel="stylesheet" type="text/css" media="all" charset="utf-8" href="C_FunctionPointers_files/common.css">
<link rel="stylesheet" type="text/css" media="screen" charset="utf-8" href="C_FunctionPointers_files/screen.css">
<link rel="stylesheet" type="text/css" media="print" charset="utf-8" href="C_FunctionPointers_files/print.css">
<style type="text/css">
ul.pagetitle{
  display: inline;
  margin: 0;
  padding: 0;
  font-size: 1.5em;
}
li.pagetitle{
  display: inline;
  margin: 0;
}
td.noborder {
  border: 0;
}
</style>
</head>
<body>
<table>
<tbody><tr>
<td class="noborder">
<img src="C_FunctionPointers_files/logo.png">
</td>
<td class="noborder">
<ul class="pagetitle">
<li class="pagetitle"><a class="backlink">C/FunctionPointers</a>
</li></ul>
<br><br>
[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/FrontPage.html">FrontPage</a>]&nbsp;[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/TitleIndex.html">TitleIndex</a>]&nbsp;[<a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/WordIndex.html">WordIndex</a>]&nbsp;
</td>
</tr>
</tbody></table>
<hr>
<div id="page"><p><b>Note:</b> You are looking at a static copy of the former PineWiki site, used for class notes by <a href="http://www.cs.yale.edu/homes/aspnes/">James Aspnes</a>
 from 2003 to 2012. Many mathematical formulas are broken, and there are
 likely to be other bugs as well. These will most likely not be fixed.  
You may be able to find more up-to-date versions of some of these notes 
at <a href="http://www.cs.yale.edu/homes/aspnes/#classes">http://www.cs.yale.edu/homes/aspnes/#classes</a>.</p>
<div dir="ltr" id="content" lang="en"><span class="anchor" id="top"></span>
<span class="anchor" id="line-1"></span><p class="line867">
</p><h1 id="Basics">1. Basics</h1>
<span class="anchor" id="line-2"></span><span class="anchor" id="line-3"></span><p class="line862">A <strong>function pointer</strong>,
 internally, is just the numerical address for the code for a function. 
 When a function name is used by itself without parentheses, the value 
is a pointer to the function, just as the name of an array by itself is a
 pointer to its zeroth element.  Function pointers can be stored in 
variables, <tt class="backtick">struct</tt>s, <tt class="backtick">union</tt>s,
 and arrays and passed to and from functions just like any other pointer
 type.  They can also be called: a variable of type function pointer can
 be used in place of a function name. <span class="anchor" id="line-4"></span><span class="anchor" id="line-5"></span></p><p class="line867">
</p><h1 id="Function_pointer_declarations">2. Function pointer declarations</h1>
<span class="anchor" id="line-6"></span><span class="anchor" id="line-7"></span><p class="line874">A
 function pointer declaration looks like a function declaration, except 
that the function name is wrapped in parentheses and preceded by an 
asterisk.  For example: <span class="anchor" id="line-8"></span><span class="anchor" id="line-9"></span></p><p class="line867"><span class="anchor" id="line-10"></span><span class="anchor" id="line-11"></span><span class="anchor" id="line-12"></span><span class="anchor" id="line-13"></span><span class="anchor" id="line-14"></span><span class="anchor" id="line-15"></span><span class="anchor" id="line-1-1"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
function isnumbered(obj) {
  return obj.childNodes.length && obj.firstChild.childNodes.length && obj.firstChild.firstChild.className == 'LineNumber';
}
function nformat(num,chrs,add) {
  var nlen = Math.max(0,chrs-(''+num).length), res = '';
  while (nlen>0) { res += ' '; nlen-- }
  return res+num+add;
}
function addnumber(did, nstart, nstep) {
  var c = document.getElementById(did), l = c.firstChild, n = 1;
  if (!isnumbered(c)) {
    if (typeof nstart == 'undefined') nstart = 1;
    if (typeof nstep  == 'undefined') nstep = 1;
    var n = nstart;
    while (l != null) {
      if (l.tagName == 'SPAN') {
        var s = document.createElement('SPAN');
        var a = document.createElement('A');
        s.className = 'LineNumber';
        a.appendChild(document.createTextNode(nformat(n,4,'')));
        a.href = '#' + did + '_' + n;
        s.appendChild(a);
        s.appendChild(document.createTextNode(' '));
        n += nstep;
        if (l.childNodes.length) {
          l.insertBefore(s, l.firstChild);
        }
        else {
          l.appendChild(s);
        }
      }
      l = l.nextSibling;
    }
  }
  return false;
}
function remnumber(did) {
  var c = document.getElementById(did), l = c.firstChild;
  if (isnumbered(c)) {
    while (l != null) {
      if (l.tagName == 'SPAN' && l.firstChild.className == 'LineNumber') l.removeChild(l.firstChild);
      l = l.nextSibling;
    }
  }
  return false;
}
function togglenumber(did, nstart, nstep) {
  var c = document.getElementById(did);
  if (isnumbered(c)) {
    remnumber(did);
  } else {
    addnumber(did,nstart,nstep);
  }
  return false;
}
</script>

<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-90629a11b46f825ee56beab1f4631723e50382c2\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-90629a11b46f825ee56beab1f4631723e50382c2', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-90629a11b46f825ee56beab1f4631723e50382c2" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-90629a11b46f825ee56beab1f4631723e50382c2_1">   1</a> </span><span class="LineAnchor" id="CA-90629a11b46f825ee56beab1f4631723e50382c2_1"></span><span class="anchor" id="line-1-2"></span><span class="Comment">/* a function taking two int arguments and returning an int */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-90629a11b46f825ee56beab1f4631723e50382c2_2">   2</a> </span><span class="LineAnchor" id="CA-90629a11b46f825ee56beab1f4631723e50382c2_2"></span><span class="anchor" id="line-2-1"></span><span class="ResWord">int</span> <span class="ID">function</span>(<span class="ResWord">int</span> <span class="ID">x</span>, <span class="ResWord">int</span> <span class="ID">y</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-90629a11b46f825ee56beab1f4631723e50382c2_3">   3</a> </span><span class="LineAnchor" id="CA-90629a11b46f825ee56beab1f4631723e50382c2_3"></span><span class="anchor" id="line-3-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-90629a11b46f825ee56beab1f4631723e50382c2_4">   4</a> </span><span class="LineAnchor" id="CA-90629a11b46f825ee56beab1f4631723e50382c2_4"></span><span class="anchor" id="line-4-1"></span><span class="Comment">/* a pointer to such a function */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-90629a11b46f825ee56beab1f4631723e50382c2_5">   5</a> </span><span class="LineAnchor" id="CA-90629a11b46f825ee56beab1f4631723e50382c2_5"></span><span class="anchor" id="line-5-1"></span><span class="ResWord">int</span> (*<span class="ID">pointer</span>)(<span class="ResWord">int</span> <span class="ID">x</span>, <span class="ResWord">int</span> <span class="ID">y</span>);</span>
</pre></div></div><span class="anchor" id="line-16"></span><span class="anchor" id="line-17"></span><p class="line874">As with function declarations, the names of the arguments can be omitted. <span class="anchor" id="line-18"></span><span class="anchor" id="line-19"></span></p><p class="line874">Here's a short program that uses function pointers: <span class="anchor" id="line-20"></span><span class="anchor" id="line-21"></span></p><p class="line867"><span class="anchor" id="line-22"></span><span class="anchor" id="line-23"></span><span class="anchor" id="line-24"></span><span class="anchor" id="line-25"></span><span class="anchor" id="line-26"></span><span class="anchor" id="line-27"></span><span class="anchor" id="line-28"></span><span class="anchor" id="line-29"></span><span class="anchor" id="line-30"></span><span class="anchor" id="line-31"></span><span class="anchor" id="line-32"></span><span class="anchor" id="line-33"></span><span class="anchor" id="line-34"></span><span class="anchor" id="line-35"></span><span class="anchor" id="line-36"></span><span class="anchor" id="line-37"></span><span class="anchor" id="line-38"></span><span class="anchor" id="line-1-3"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_1">   1</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_1"></span><span class="anchor" id="line-1-4"></span><span class="Preprc">/* Functional "hello world" program */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_2">   2</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_2"></span><span class="anchor" id="line-2-2"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_3">   3</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_3"></span><span class="anchor" id="line-3-2"></span><span class="Preprc">#</span><span class="Preprc">include &lt;stdio.h&gt;</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_4">   4</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_4"></span><span class="anchor" id="line-4-2"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_5">   5</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_5"></span><span class="anchor" id="line-5-2"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_6">   6</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_6"></span><span class="anchor" id="line-6-1"></span><span class="ID">main</span>(<span class="ResWord">int</span> <span class="ID">argc</span>, <span class="ResWord">char</span> **<span class="ID">argv</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_7">   7</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_7"></span><span class="anchor" id="line-7-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_8">   8</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_8"></span><span class="anchor" id="line-8-1"></span>    <span class="Comment">/* function for emitting text */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_9">   9</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_9"></span><span class="anchor" id="line-9-1"></span>    <span class="ResWord">int</span> (*<span class="ID">say</span>)(<span class="ResWord">const</span> <span class="ResWord">char</span> *);</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_10">  10</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_10"></span><span class="anchor" id="line-10-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_11">  11</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_11"></span><span class="anchor" id="line-11-1"></span>    <span class="ID">say</span> = <span class="ID">puts</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_12">  12</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_12"></span><span class="anchor" id="line-12-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_13">  13</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_13"></span><span class="anchor" id="line-13-1"></span>    <span class="ID">say</span>(<span class="String">"</span><span class="String">hello world</span><span class="String">"</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_14">  14</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_14"></span><span class="anchor" id="line-14-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_15">  15</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_15"></span><span class="anchor" id="line-15-1"></span>    <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_16">  16</a> </span><span class="LineAnchor" id="CA-544d57ff7aefb4b6d87e34e5d09a8dd0a17f9db4_16"></span><span class="anchor" id="line-16-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-39"></span><span class="anchor" id="line-40"></span><p class="line867">
</p><h1 id="Applications">3. Applications</h1>
<span class="anchor" id="line-41"></span><span class="anchor" id="line-42"></span><p class="line874">Function pointers are not used as much in C as in functional languages, but there are many common uses even in C code. <span class="anchor" id="line-43"></span><span class="anchor" id="line-44"></span></p><p class="line867">
</p><h2 id="Callbacks">3.1. Callbacks</h2>
<span class="anchor" id="line-45"></span><span class="anchor" id="line-46"></span><p class="line862">The classic example is <tt class="backtick">qsort</tt>, from the standard library: <span class="anchor" id="line-47"></span><span class="anchor" id="line-48"></span></p><p class="line867"><span class="anchor" id="line-49"></span><span class="anchor" id="line-50"></span><span class="anchor" id="line-51"></span><span class="anchor" id="line-52"></span><span class="anchor" id="line-1-5"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-da32a83d9875d271026b2039a8323dc0fd87b60b\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-da32a83d9875d271026b2039a8323dc0fd87b60b', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-da32a83d9875d271026b2039a8323dc0fd87b60b" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-da32a83d9875d271026b2039a8323dc0fd87b60b_1">   1</a> </span><span class="LineAnchor" id="CA-da32a83d9875d271026b2039a8323dc0fd87b60b_1"></span><span class="anchor" id="line-1-6"></span><span class="Comment">/* defined in stdlib.h */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-da32a83d9875d271026b2039a8323dc0fd87b60b_2">   2</a> </span><span class="LineAnchor" id="CA-da32a83d9875d271026b2039a8323dc0fd87b60b_2"></span><span class="anchor" id="line-2-3"></span><span class="ResWord">void</span> <span class="ID">qsort</span>(<span class="ResWord">void</span> *<span class="ID">base</span>, <span class="ID">size_t</span> <span class="ID">n</span>, <span class="ID">size_t</span> <span class="ID">size</span>,</span>
<span class="line"><span class="LineNumber"><a href="#CA-da32a83d9875d271026b2039a8323dc0fd87b60b_3">   3</a> </span><span class="LineAnchor" id="CA-da32a83d9875d271026b2039a8323dc0fd87b60b_3"></span><span class="anchor" id="line-3-3"></span>    <span class="ResWord">int</span> (*<span class="ID">cmp</span>)(<span class="ResWord">const</span> <span class="ResWord">void</span> *<span class="ID">key1</span>, <span class="ResWord">const</span> <span class="ResWord">void</span> *<span class="ID">key2</span>));</span>
</pre></div></div><span class="anchor" id="line-53"></span><span class="anchor" id="line-54"></span><p class="line874">This is a generic sorting routine that will sort any array in place.  It needs <span class="anchor" id="line-55"></span>to know (a) the base address of the array; (b) how many elements there are; <span class="anchor" id="line-56"></span>(c) how big each element is; and (d) how to compare two elements.  The only <span class="anchor" id="line-57"></span>tricky part is supplying the comparison, which could involve <span class="anchor" id="line-58"></span>arbitrarily-complex code.  So we supply this code as a function with an <span class="anchor" id="line-59"></span>interface similar to <tt class="backtick">strcmp</tt>. <span class="anchor" id="line-60"></span><span class="anchor" id="line-61"></span></p><p class="line867"><span class="anchor" id="line-62"></span><span class="anchor" id="line-63"></span><span class="anchor" id="line-64"></span><span class="anchor" id="line-65"></span><span class="anchor" id="line-66"></span><span class="anchor" id="line-67"></span><span class="anchor" id="line-68"></span><span class="anchor" id="line-69"></span><span class="anchor" id="line-70"></span><span class="anchor" id="line-71"></span><span class="anchor" id="line-72"></span><span class="anchor" id="line-73"></span><span class="anchor" id="line-1-7"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_1">   1</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_1"></span><span class="anchor" id="line-1-8"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_2">   2</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_2"></span><span class="anchor" id="line-2-4"></span><span class="ID">compare_ints</span>(<span class="ResWord">void</span> *<span class="ID">key1</span>, <span class="ResWord">void</span> *<span class="ID">key2</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_3">   3</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_3"></span><span class="anchor" id="line-3-4"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_4">   4</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_4"></span><span class="anchor" id="line-4-3"></span>    <span class="ResWord">return</span> *((<span class="ResWord">int</span> *) <span class="ID">key1</span>) - *((<span class="ResWord">int</span> *) <span class="ID">key2</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_5">   5</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_5"></span><span class="anchor" id="line-5-3"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_6">   6</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_6"></span><span class="anchor" id="line-6-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_7">   7</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_7"></span><span class="anchor" id="line-7-2"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_8">   8</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_8"></span><span class="anchor" id="line-8-2"></span><span class="ID">sort_int_array</span>(<span class="ResWord">int</span> *<span class="ID">a</span>, <span class="ResWord">int</span> <span class="ID">n</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_9">   9</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_9"></span><span class="anchor" id="line-9-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_10">  10</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_10"></span><span class="anchor" id="line-10-2"></span>    <span class="ID">qsort</span>(<span class="ID">a</span>, <span class="ID">n</span>, <span class="ResWord">sizeof</span>(*<span class="ID">a</span>), <span class="ID">compare_ints</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_11">  11</a> </span><span class="LineAnchor" id="CA-f5afb401d8d77ff2da16ebb7287b24dc810c5435_11"></span><span class="anchor" id="line-11-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-74"></span><span class="anchor" id="line-75"></span><p class="line874">Other examples might include things like registering an error handler for a <span class="anchor" id="line-76"></span>library, instead of just having it call <tt class="backtick">abort()</tt> or something equally <span class="anchor" id="line-77"></span>catastrophic, or providing a cleanup function for freeing data passed into a data structure. <span class="anchor" id="line-78"></span><span class="anchor" id="line-79"></span></p><p class="line867">
</p><h2 id="Dispatch_tables">3.2. Dispatch tables</h2>
<span class="anchor" id="line-80"></span><span class="anchor" id="line-81"></span><p class="line862">Alternative to gigantic <tt class="backtick">if/else&nbsp;if</tt> or <tt class="backtick">switch</tt> statements.  See page 234 of <span class="anchor" id="line-82"></span><a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/KernighanPike.html">KernighanPike</a> for a good example of this. <span class="anchor" id="line-83"></span><span class="anchor" id="line-84"></span></p><p class="line867">
</p><h2 id="Iterators">3.3. Iterators</h2>
<span class="anchor" id="line-85"></span><span class="anchor" id="line-86"></span><p class="line862">See <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/C%282f%29Iterators.html">C/Iterators</a>. <span class="anchor" id="line-87"></span><span class="anchor" id="line-88"></span></p><p class="line867">
</p><h1 id="Closures">4. Closures</h1>
<span class="anchor" id="line-89"></span><span class="anchor" id="line-90"></span><p class="line862">A <strong>closure</strong> is a function plus some associated state.  A simple way to <span class="anchor" id="line-91"></span>implement closures in C is to use a <tt class="backtick">static</tt> local variable, but then you only <span class="anchor" id="line-92"></span>get one.  Better is to allocate the state somewhere and pass it around with <span class="anchor" id="line-93"></span>the function.  For example, here's a simple functional implementation of <span class="anchor" id="line-94"></span>infinite sequences, that generalizes the example in <a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/AbstractDataTypes.html">AbstractDataTypes</a>: <span class="anchor" id="line-95"></span><span class="anchor" id="line-96"></span></p><p class="line867"><span class="anchor" id="line-97"></span><span class="anchor" id="line-98"></span><span class="anchor" id="line-99"></span><span class="anchor" id="line-100"></span><span class="anchor" id="line-101"></span><span class="anchor" id="line-102"></span><span class="anchor" id="line-103"></span><span class="anchor" id="line-104"></span><span class="anchor" id="line-105"></span><span class="anchor" id="line-106"></span><span class="anchor" id="line-107"></span><span class="anchor" id="line-108"></span><span class="anchor" id="line-109"></span><span class="anchor" id="line-110"></span><span class="anchor" id="line-111"></span><span class="anchor" id="line-112"></span><span class="anchor" id="line-113"></span><span class="anchor" id="line-114"></span><span class="anchor" id="line-115"></span><span class="anchor" id="line-116"></span><span class="anchor" id="line-117"></span><span class="anchor" id="line-118"></span><span class="anchor" id="line-119"></span><span class="anchor" id="line-120"></span><span class="anchor" id="line-121"></span><span class="anchor" id="line-122"></span><span class="anchor" id="line-123"></span><span class="anchor" id="line-124"></span><span class="anchor" id="line-1-9"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-5a70cf85c824af08af2808f33e581badefefb1f9\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-5a70cf85c824af08af2808f33e581badefefb1f9', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_1">   1</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_1"></span><span class="anchor" id="line-1-10"></span><span class="Comment">/* a sequence is an object that returns a new value each time it is called */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_2">   2</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_2"></span><span class="anchor" id="line-2-5"></span><span class="ResWord">struct</span> <span class="ID">sequence</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_3">   3</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_3"></span><span class="anchor" id="line-3-5"></span>    <span class="ResWord">int</span> (*<span class="ID">next</span>)(<span class="ResWord">void</span> *<span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_4">   4</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_4"></span><span class="anchor" id="line-4-4"></span>    <span class="ResWord">void</span> *<span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_5">   5</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_5"></span><span class="anchor" id="line-5-4"></span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_6">   6</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_6"></span><span class="anchor" id="line-6-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_7">   7</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_7"></span><span class="anchor" id="line-7-3"></span><span class="ResWord">typedef</span> <span class="ResWord">struct</span> <span class="ID">sequence</span> *<span class="ID">Sequence</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_8">   8</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_8"></span><span class="anchor" id="line-8-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_9">   9</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_9"></span><span class="anchor" id="line-9-3"></span><span class="ID">Sequence</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_10">  10</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_10"></span><span class="anchor" id="line-10-3"></span><span class="ID">create_sequence</span>(<span class="ResWord">int</span> (*<span class="ID">next</span>)(<span class="ResWord">void</span> *<span class="ID">data</span>), <span class="ResWord">void</span> *<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_11">  11</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_11"></span><span class="anchor" id="line-11-3"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_12">  12</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_12"></span><span class="anchor" id="line-12-2"></span>    <span class="ID">Sequence</span> <span class="ID">s</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_13">  13</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_13"></span><span class="anchor" id="line-13-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_14">  14</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_14"></span><span class="anchor" id="line-14-2"></span>    <span class="ID">s</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(*<span class="ID">s</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_15">  15</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_15"></span><span class="anchor" id="line-15-2"></span>    <span class="ID">assert</span>(<span class="ID">s</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_16">  16</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_16"></span><span class="anchor" id="line-16-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_17">  17</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_17"></span><span class="anchor" id="line-17-1"></span>    <span class="ID">s</span>-&gt;<span class="ID">next</span> = <span class="ID">next</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_18">  18</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_18"></span><span class="anchor" id="line-18-1"></span>    <span class="ID">s</span>-&gt;<span class="ID">data</span> = <span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_19">  19</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_19"></span><span class="anchor" id="line-19-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_20">  20</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_20"></span><span class="anchor" id="line-20-1"></span>    <span class="ResWord">return</span> <span class="ID">s</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_21">  21</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_21"></span><span class="anchor" id="line-21-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_22">  22</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_22"></span><span class="anchor" id="line-22-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_23">  23</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_23"></span><span class="anchor" id="line-23-1"></span><span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_24">  24</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_24"></span><span class="anchor" id="line-24-1"></span><span class="ID">sequence_next</span>(<span class="ID">Sequence</span> <span class="ID">s</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_25">  25</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_25"></span><span class="anchor" id="line-25-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_26">  26</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_26"></span><span class="anchor" id="line-26-1"></span>    <span class="ResWord">return</span> <span class="ID">s</span>-&gt;<span class="ID">next</span>(<span class="ID">s</span>-&gt;<span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-5a70cf85c824af08af2808f33e581badefefb1f9_27">  27</a> </span><span class="LineAnchor" id="CA-5a70cf85c824af08af2808f33e581badefefb1f9_27"></span><span class="anchor" id="line-27-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-125"></span><span class="anchor" id="line-126"></span><p class="line874">And here are some examples of sequences: <span class="anchor" id="line-127"></span><span class="anchor" id="line-128"></span></p><p class="line867"><span class="anchor" id="line-129"></span><span class="anchor" id="line-130"></span><span class="anchor" id="line-131"></span><span class="anchor" id="line-132"></span><span class="anchor" id="line-133"></span><span class="anchor" id="line-134"></span><span class="anchor" id="line-135"></span><span class="anchor" id="line-136"></span><span class="anchor" id="line-137"></span><span class="anchor" id="line-138"></span><span class="anchor" id="line-139"></span><span class="anchor" id="line-140"></span><span class="anchor" id="line-141"></span><span class="anchor" id="line-142"></span><span class="anchor" id="line-143"></span><span class="anchor" id="line-144"></span><span class="anchor" id="line-145"></span><span class="anchor" id="line-146"></span><span class="anchor" id="line-147"></span><span class="anchor" id="line-148"></span><span class="anchor" id="line-149"></span><span class="anchor" id="line-150"></span><span class="anchor" id="line-151"></span><span class="anchor" id="line-152"></span><span class="anchor" id="line-153"></span><span class="anchor" id="line-154"></span><span class="anchor" id="line-155"></span><span class="anchor" id="line-156"></span><span class="anchor" id="line-157"></span><span class="anchor" id="line-158"></span><span class="anchor" id="line-159"></span><span class="anchor" id="line-160"></span><span class="anchor" id="line-161"></span><span class="anchor" id="line-162"></span><span class="anchor" id="line-163"></span><span class="anchor" id="line-164"></span><span class="anchor" id="line-165"></span><span class="anchor" id="line-166"></span><span class="anchor" id="line-167"></span><span class="anchor" id="line-168"></span><span class="anchor" id="line-169"></span><span class="anchor" id="line-170"></span><span class="anchor" id="line-171"></span><span class="anchor" id="line-172"></span><span class="anchor" id="line-173"></span><span class="anchor" id="line-174"></span><span class="anchor" id="line-175"></span><span class="anchor" id="line-176"></span><span class="anchor" id="line-177"></span><span class="anchor" id="line-178"></span><span class="anchor" id="line-179"></span><span class="anchor" id="line-180"></span><span class="anchor" id="line-181"></span><span class="anchor" id="line-182"></span><span class="anchor" id="line-183"></span><span class="anchor" id="line-184"></span><span class="anchor" id="line-185"></span><span class="anchor" id="line-186"></span><span class="anchor" id="line-187"></span><span class="anchor" id="line-188"></span><span class="anchor" id="line-189"></span><span class="anchor" id="line-190"></span><span class="anchor" id="line-191"></span><span class="anchor" id="line-192"></span><span class="anchor" id="line-193"></span><span class="anchor" id="line-194"></span><span class="anchor" id="line-195"></span><span class="anchor" id="line-196"></span><span class="anchor" id="line-197"></span><span class="anchor" id="line-198"></span><span class="anchor" id="line-199"></span><span class="anchor" id="line-200"></span><span class="anchor" id="line-201"></span><span class="anchor" id="line-202"></span><span class="anchor" id="line-203"></span><span class="anchor" id="line-204"></span><span class="anchor" id="line-205"></span><span class="anchor" id="line-206"></span><span class="anchor" id="line-207"></span><span class="anchor" id="line-208"></span><span class="anchor" id="line-209"></span><span class="anchor" id="line-210"></span><span class="anchor" id="line-211"></span><span class="anchor" id="line-212"></span><span class="anchor" id="line-213"></span><span class="anchor" id="line-214"></span><span class="anchor" id="line-215"></span><span class="anchor" id="line-216"></span><span class="anchor" id="line-217"></span><span class="anchor" id="line-218"></span><span class="anchor" id="line-219"></span><span class="anchor" id="line-220"></span><span class="anchor" id="line-221"></span><span class="anchor" id="line-222"></span><span class="anchor" id="line-223"></span><span class="anchor" id="line-224"></span><span class="anchor" id="line-225"></span><span class="anchor" id="line-226"></span><span class="anchor" id="line-227"></span><span class="anchor" id="line-228"></span><span class="anchor" id="line-229"></span><span class="anchor" id="line-230"></span><span class="anchor" id="line-231"></span><span class="anchor" id="line-232"></span><span class="anchor" id="line-233"></span><span class="anchor" id="line-234"></span><span class="anchor" id="line-235"></span><span class="anchor" id="line-236"></span><span class="anchor" id="line-237"></span><span class="anchor" id="line-1-11"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-061910ac72109cef077a743dcfe00f3f0c78dadf\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-061910ac72109cef077a743dcfe00f3f0c78dadf', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_1">   1</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_1"></span><span class="anchor" id="line-1-12"></span><span class="Comment">/* make a constant sequence that always returns x */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_2">   2</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_2"></span><span class="anchor" id="line-2-6"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_3">   3</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_3"></span><span class="anchor" id="line-3-6"></span><span class="ID">constant_sequence_next</span>(<span class="ResWord">void</span> *<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_4">   4</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_4"></span><span class="anchor" id="line-4-5"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_5">   5</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_5"></span><span class="anchor" id="line-5-5"></span>    <span class="ResWord">return</span> *((<span class="ResWord">int</span> *) <span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_6">   6</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_6"></span><span class="anchor" id="line-6-4"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_7">   7</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_7"></span><span class="anchor" id="line-7-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_8">   8</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_8"></span><span class="anchor" id="line-8-4"></span><span class="ID">Sequence</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_9">   9</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_9"></span><span class="anchor" id="line-9-4"></span><span class="ID">constant_sequence</span>(<span class="ResWord">int</span> <span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_10">  10</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_10"></span><span class="anchor" id="line-10-4"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_11">  11</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_11"></span><span class="anchor" id="line-11-4"></span>    <span class="ResWord">int</span> *<span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_12">  12</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_12"></span><span class="anchor" id="line-12-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_13">  13</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_13"></span><span class="anchor" id="line-13-3"></span>    <span class="ID">data</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(*<span class="ID">data</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_14">  14</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_14"></span><span class="anchor" id="line-14-3"></span>    <span class="ResWord">if</span>(<span class="ID">data</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_15">  15</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_15"></span><span class="anchor" id="line-15-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_16">  16</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_16"></span><span class="anchor" id="line-16-3"></span>    *<span class="ID">data</span> = <span class="ID">x</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_17">  17</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_17"></span><span class="anchor" id="line-17-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_18">  18</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_18"></span><span class="anchor" id="line-18-2"></span>    <span class="ResWord">return</span> <span class="ID">create_sequence</span>(<span class="ID">constant_sequence_next</span>, <span class="ID">data</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_19">  19</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_19"></span><span class="anchor" id="line-19-2"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_20">  20</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_20"></span><span class="anchor" id="line-20-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_21">  21</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_21"></span><span class="anchor" id="line-21-2"></span><span class="Comment">/* make a sequence x, x+a, x+2*a, x+3*a, ... */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_22">  22</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_22"></span><span class="anchor" id="line-22-2"></span><span class="ResWord">struct</span> <span class="ID">arithmetic_sequence_data</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_23">  23</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_23"></span><span class="anchor" id="line-23-2"></span>    <span class="ResWord">int</span> <span class="ID">cur</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_24">  24</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_24"></span><span class="anchor" id="line-24-2"></span>    <span class="ResWord">int</span> <span class="ID">step</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_25">  25</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_25"></span><span class="anchor" id="line-25-2"></span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_26">  26</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_26"></span><span class="anchor" id="line-26-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_27">  27</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_27"></span><span class="anchor" id="line-27-2"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_28">  28</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_28"></span><span class="anchor" id="line-28-1"></span><span class="ID">arithmetic_sequence_next</span>(<span class="ResWord">void</span> *<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_29">  29</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_29"></span><span class="anchor" id="line-29-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_30">  30</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_30"></span><span class="anchor" id="line-30-1"></span>    <span class="ResWord">struct</span> <span class="ID">arithmetic_sequence_data</span> *<span class="ID">d</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_31">  31</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_31"></span><span class="anchor" id="line-31-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_32">  32</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_32"></span><span class="anchor" id="line-32-1"></span>    <span class="ID">d</span> = <span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_33">  33</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_33"></span><span class="anchor" id="line-33-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">cur</span> += <span class="ID">d</span>-&gt;<span class="ID">step</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_34">  34</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_34"></span><span class="anchor" id="line-34-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_35">  35</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_35"></span><span class="anchor" id="line-35-1"></span>    <span class="ResWord">return</span> <span class="ID">d</span>-&gt;<span class="ID">cur</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_36">  36</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_36"></span><span class="anchor" id="line-36-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_37">  37</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_37"></span><span class="anchor" id="line-37-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_38">  38</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_38"></span><span class="anchor" id="line-38-1"></span><span class="ID">Sequence</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_39">  39</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_39"></span><span class="anchor" id="line-39-1"></span><span class="ID">arithmetic_sequence</span>(<span class="ResWord">int</span> <span class="ID">x</span>, <span class="ResWord">int</span> <span class="ID">a</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_40">  40</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_40"></span><span class="anchor" id="line-40-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_41">  41</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_41"></span><span class="anchor" id="line-41-1"></span>    <span class="ResWord">struct</span> <span class="ID">arithmetic_sequence_data</span> *<span class="ID">d</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_42">  42</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_42"></span><span class="anchor" id="line-42-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_43">  43</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_43"></span><span class="anchor" id="line-43-1"></span>    <span class="ID">d</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(*<span class="ID">d</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_44">  44</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_44"></span><span class="anchor" id="line-44-1"></span>    <span class="ResWord">if</span>(<span class="ID">d</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_45">  45</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_45"></span><span class="anchor" id="line-45-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_46">  46</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_46"></span><span class="anchor" id="line-46-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">cur</span> = <span class="ID">x</span> - <span class="ID">a</span>;             <span class="Comment">/* back up so first value returned is x */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_47">  47</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_47"></span><span class="anchor" id="line-47-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">step</span> = <span class="ID">a</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_48">  48</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_48"></span><span class="anchor" id="line-48-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_49">  49</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_49"></span><span class="anchor" id="line-49-1"></span>    <span class="ResWord">return</span> <span class="ID">create_sequence</span>(<span class="ID">arithmetic_sequence_next</span>, <span class="ID">d</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_50">  50</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_50"></span><span class="anchor" id="line-50-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_51">  51</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_51"></span><span class="anchor" id="line-51-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_52">  52</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_52"></span><span class="anchor" id="line-52-1"></span><span class="Comment">/* Return the sum of two sequences */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_53">  53</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_53"></span><span class="anchor" id="line-53-1"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_54">  54</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_54"></span><span class="anchor" id="line-54-1"></span><span class="ID">add_sequences_next</span>(<span class="ResWord">void</span> *<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_55">  55</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_55"></span><span class="anchor" id="line-55-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_56">  56</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_56"></span><span class="anchor" id="line-56-1"></span>    <span class="ID">Sequence</span> *<span class="ID">s</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_57">  57</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_57"></span><span class="anchor" id="line-57-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_58">  58</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_58"></span><span class="anchor" id="line-58-1"></span>    <span class="ID">s</span> = <span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_59">  59</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_59"></span><span class="anchor" id="line-59-1"></span>    <span class="ResWord">return</span> <span class="ID">sequence_next</span>(<span class="ID">s</span>[<span class="Number">0</span>]) + <span class="ID">sequence_next</span>(<span class="ID">s</span>[<span class="Number">1</span>]);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_60">  60</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_60"></span><span class="anchor" id="line-60-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_61">  61</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_61"></span><span class="anchor" id="line-61-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_62">  62</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_62"></span><span class="anchor" id="line-62-1"></span><span class="ID">Sequence</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_63">  63</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_63"></span><span class="anchor" id="line-63-1"></span><span class="ID">add_sequences</span>(<span class="ID">Sequence</span> <span class="ID">s0</span>, <span class="ID">Sequence</span> <span class="ID">s1</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_64">  64</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_64"></span><span class="anchor" id="line-64-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_65">  65</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_65"></span><span class="anchor" id="line-65-1"></span>    <span class="ID">Sequence</span> *<span class="ID">s</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_66">  66</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_66"></span><span class="anchor" id="line-66-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_67">  67</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_67"></span><span class="anchor" id="line-67-1"></span>    <span class="ID">s</span> = <span class="ID">malloc</span>(<span class="Number">2</span>*<span class="ResWord">sizeof</span>(*<span class="ID">s</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_68">  68</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_68"></span><span class="anchor" id="line-68-1"></span>    <span class="ResWord">if</span>(<span class="ID">s</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_69">  69</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_69"></span><span class="anchor" id="line-69-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_70">  70</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_70"></span><span class="anchor" id="line-70-1"></span>    <span class="ID">s</span>[<span class="Number">0</span>] = <span class="ID">s0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_71">  71</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_71"></span><span class="anchor" id="line-71-1"></span>    <span class="ID">s</span>[<span class="Number">1</span>] = <span class="ID">s1</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_72">  72</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_72"></span><span class="anchor" id="line-72-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_73">  73</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_73"></span><span class="anchor" id="line-73-1"></span>    <span class="ResWord">return</span> <span class="ID">create_sequence</span>(<span class="ID">add_sequences_next</span>, <span class="ID">s</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_74">  74</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_74"></span><span class="anchor" id="line-74-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_75">  75</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_75"></span><span class="anchor" id="line-75-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_76">  76</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_76"></span><span class="anchor" id="line-76-1"></span><span class="Comment">/* Return the sequence x, f(x), f(f(x)), ... */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_77">  77</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_77"></span><span class="anchor" id="line-77-1"></span><span class="ResWord">struct</span> <span class="ID">iterated_function_sequence_data</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_78">  78</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_78"></span><span class="anchor" id="line-78-1"></span>    <span class="ResWord">int</span> <span class="ID">x</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_79">  79</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_79"></span><span class="anchor" id="line-79-1"></span>    <span class="ResWord">int</span> (*<span class="ID">f</span>)(<span class="ResWord">int</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_80">  80</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_80"></span><span class="anchor" id="line-80-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_81">  81</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_81"></span><span class="anchor" id="line-81-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_82">  82</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_82"></span><span class="anchor" id="line-82-1"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_83">  83</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_83"></span><span class="anchor" id="line-83-1"></span><span class="ID">iterated_function_sequence_next</span>(<span class="ResWord">void</span> *<span class="ID">data</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_84">  84</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_84"></span><span class="anchor" id="line-84-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_85">  85</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_85"></span><span class="anchor" id="line-85-1"></span>    <span class="ResWord">struct</span> <span class="ID">iterated_function_sequence_data</span> *<span class="ID">d</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_86">  86</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_86"></span><span class="anchor" id="line-86-1"></span>    <span class="ResWord">int</span> <span class="ID">retval</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_87">  87</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_87"></span><span class="anchor" id="line-87-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_88">  88</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_88"></span><span class="anchor" id="line-88-1"></span>    <span class="ID">d</span> = <span class="ID">data</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_89">  89</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_89"></span><span class="anchor" id="line-89-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_90">  90</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_90"></span><span class="anchor" id="line-90-1"></span>    <span class="ID">retval</span> = <span class="ID">d</span>-&gt;<span class="ID">x</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_91">  91</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_91"></span><span class="anchor" id="line-91-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">x</span> = <span class="ID">d</span>-&gt;<span class="ID">f</span>(<span class="ID">d</span>-&gt;<span class="ID">x</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_92">  92</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_92"></span><span class="anchor" id="line-92-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_93">  93</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_93"></span><span class="anchor" id="line-93-1"></span>    <span class="ResWord">return</span> <span class="ID">retval</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_94">  94</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_94"></span><span class="anchor" id="line-94-1"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_95">  95</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_95"></span><span class="anchor" id="line-95-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_96">  96</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_96"></span><span class="anchor" id="line-96-1"></span><span class="ID">Sequence</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_97">  97</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_97"></span><span class="anchor" id="line-97-1"></span><span class="ID">iterated_function_sequence</span>(<span class="ResWord">int</span> (*<span class="ID">f</span>)(<span class="ResWord">int</span>), <span class="ResWord">int</span> <span class="ID">x0</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_98">  98</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_98"></span><span class="anchor" id="line-98-1"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_99">  99</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_99"></span><span class="anchor" id="line-99-1"></span>    <span class="ResWord">struct</span> <span class="ID">iterated_function_sequence_data</span> *<span class="ID">d</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_100"> 100</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_100"></span><span class="anchor" id="line-100-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_101"> 101</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_101"></span><span class="anchor" id="line-101-1"></span>    <span class="ID">d</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(*<span class="ID">d</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_102"> 102</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_102"></span><span class="anchor" id="line-102-1"></span>    <span class="ResWord">if</span>(<span class="ID">d</span> == <span class="Number">0</span>) <span class="ResWord">return</span> <span class="Number">0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_103"> 103</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_103"></span><span class="anchor" id="line-103-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_104"> 104</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_104"></span><span class="anchor" id="line-104-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">x</span> = <span class="ID">x0</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_105"> 105</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_105"></span><span class="anchor" id="line-105-1"></span>    <span class="ID">d</span>-&gt;<span class="ID">f</span> = <span class="ID">f</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_106"> 106</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_106"></span><span class="anchor" id="line-106-1"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_107"> 107</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_107"></span><span class="anchor" id="line-107-1"></span>    <span class="ResWord">return</span> <span class="ID">create_sequence</span>(<span class="ID">iterated_function_sequence_next</span>, <span class="ID">d</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-061910ac72109cef077a743dcfe00f3f0c78dadf_108"> 108</a> </span><span class="LineAnchor" id="CA-061910ac72109cef077a743dcfe00f3f0c78dadf_108"></span><span class="anchor" id="line-108-1"></span>}</span>
</pre></div></div><span class="anchor" id="line-238"></span><span class="anchor" id="line-239"></span><p class="line862">Note that we haven't worried about how to free the <tt class="backtick">data</tt> field inside a <span class="anchor" id="line-240"></span><tt class="backtick">Sequence</tt>, and indeed it's not obvious that we can write a generic data-freeing <span class="anchor" id="line-241"></span>routine since we don't know what structure it has.  The solution is to add <span class="anchor" id="line-242"></span>more function pointers to a <tt class="backtick">Sequence</tt>, so that we can get the next value, get <span class="anchor" id="line-243"></span>the sequence to destroy itself, etc.  When we do so, we have gone beyond <span class="anchor" id="line-244"></span>building a closure to building an <strong>object</strong>. <span class="anchor" id="line-245"></span><span class="anchor" id="line-246"></span></p><p class="line867">
</p><h1 id="Objects">5. Objects</h1>
<span class="anchor" id="line-247"></span><span class="anchor" id="line-248"></span><p class="line874">Here's an example of a hierarchy of counter objects.  Each counter object has <span class="anchor" id="line-249"></span>(at least) three operations: <tt class="backtick">reset</tt>, <tt class="backtick">next</tt>, and <tt class="backtick">destroy</tt>.  To call the <span class="anchor" id="line-250"></span><tt class="backtick">next</tt> operation on counter <tt class="backtick">c</tt> we include <tt class="backtick">c</tt> and the first argument, e.g. <span class="anchor" id="line-251"></span><tt class="backtick">c-&gt;next(c)</tt> (one could write a wrapper to enforce this). <span class="anchor" id="line-252"></span><span class="anchor" id="line-253"></span></p><p class="line874">The main trick is that we define a basic counter structure and then extend it <span class="anchor" id="line-254"></span>to include additional data, using lots of pointer conversions to make <span class="anchor" id="line-255"></span>everything work. <span class="anchor" id="line-256"></span><span class="anchor" id="line-257"></span></p><p class="line867"><span class="anchor" id="line-258"></span><span class="anchor" id="line-259"></span><span class="anchor" id="line-260"></span><span class="anchor" id="line-261"></span><span class="anchor" id="line-262"></span><span class="anchor" id="line-263"></span><span class="anchor" id="line-264"></span><span class="anchor" id="line-265"></span><span class="anchor" id="line-266"></span><span class="anchor" id="line-267"></span><span class="anchor" id="line-268"></span><span class="anchor" id="line-269"></span><span class="anchor" id="line-270"></span><span class="anchor" id="line-271"></span><span class="anchor" id="line-272"></span><span class="anchor" id="line-273"></span><span class="anchor" id="line-274"></span><span class="anchor" id="line-275"></span><span class="anchor" id="line-276"></span><span class="anchor" id="line-277"></span><span class="anchor" id="line-278"></span><span class="anchor" id="line-279"></span><span class="anchor" id="line-280"></span><span class="anchor" id="line-281"></span><span class="anchor" id="line-282"></span><span class="anchor" id="line-283"></span><span class="anchor" id="line-284"></span><span class="anchor" id="line-285"></span><span class="anchor" id="line-286"></span><span class="anchor" id="line-287"></span><span class="anchor" id="line-288"></span><span class="anchor" id="line-289"></span><span class="anchor" id="line-290"></span><span class="anchor" id="line-291"></span><span class="anchor" id="line-292"></span><span class="anchor" id="line-293"></span><span class="anchor" id="line-294"></span><span class="anchor" id="line-295"></span><span class="anchor" id="line-296"></span><span class="anchor" id="line-297"></span><span class="anchor" id="line-298"></span><span class="anchor" id="line-299"></span><span class="anchor" id="line-300"></span><span class="anchor" id="line-301"></span><span class="anchor" id="line-302"></span><span class="anchor" id="line-303"></span><span class="anchor" id="line-304"></span><span class="anchor" id="line-305"></span><span class="anchor" id="line-306"></span><span class="anchor" id="line-307"></span><span class="anchor" id="line-308"></span><span class="anchor" id="line-309"></span><span class="anchor" id="line-310"></span><span class="anchor" id="line-311"></span><span class="anchor" id="line-312"></span><span class="anchor" id="line-313"></span><span class="anchor" id="line-314"></span><span class="anchor" id="line-315"></span><span class="anchor" id="line-316"></span><span class="anchor" id="line-317"></span><span class="anchor" id="line-318"></span><span class="anchor" id="line-319"></span><span class="anchor" id="line-320"></span><span class="anchor" id="line-321"></span><span class="anchor" id="line-322"></span><span class="anchor" id="line-323"></span><span class="anchor" id="line-324"></span><span class="anchor" id="line-325"></span><span class="anchor" id="line-326"></span><span class="anchor" id="line-327"></span><span class="anchor" id="line-328"></span><span class="anchor" id="line-329"></span><span class="anchor" id="line-330"></span><span class="anchor" id="line-331"></span><span class="anchor" id="line-332"></span><span class="anchor" id="line-333"></span><span class="anchor" id="line-334"></span><span class="anchor" id="line-335"></span><span class="anchor" id="line-336"></span><span class="anchor" id="line-337"></span><span class="anchor" id="line-1-13"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-9118d7711627258636493d8a983c112bd7097149\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-9118d7711627258636493d8a983c112bd7097149', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-9118d7711627258636493d8a983c112bd7097149" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_1">   1</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_1"></span><span class="anchor" id="line-1-14"></span><span class="Preprc">/* use preprocessor to avoid rewriting these */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_2">   2</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_2"></span><span class="anchor" id="line-2-7"></span><span class="Preprc">#</span><span class="Preprc">define COUNTER_FIELDS  \</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_3">   3</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_3"></span><span class="anchor" id="line-3-7"></span><span class="Preprc"></span><span class="Preprc">    void (*reset)(struct counter *);    \</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_4">   4</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_4"></span><span class="anchor" id="line-4-6"></span><span class="Preprc"></span><span class="Preprc">    int (*next)(struct counter *);      \</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_5">   5</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_5"></span><span class="anchor" id="line-5-6"></span><span class="Preprc"></span><span class="Preprc">    void (*destroy)(struct counter *);</span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_6">   6</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_6"></span><span class="anchor" id="line-6-5"></span><span class="Preprc"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_7">   7</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_7"></span><span class="anchor" id="line-7-5"></span><span class="ResWord">struct</span> <span class="ID">counter</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_8">   8</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_8"></span><span class="anchor" id="line-8-5"></span>    <span class="ID">COUNTER_FIELDS</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_9">   9</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_9"></span><span class="anchor" id="line-9-5"></span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_10">  10</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_10"></span><span class="anchor" id="line-10-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_11">  11</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_11"></span><span class="anchor" id="line-11-5"></span><span class="ResWord">typedef</span> <span class="ResWord">struct</span> <span class="ID">counter</span> *<span class="ID">Counter</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_12">  12</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_12"></span><span class="anchor" id="line-12-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_13">  13</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_13"></span><span class="anchor" id="line-13-4"></span><span class="Comment">/* minimal counter--always returns zero */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_14">  14</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_14"></span><span class="anchor" id="line-14-4"></span><span class="Comment">/* we don't even allocate this, just have one global one */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_15">  15</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_15"></span><span class="anchor" id="line-15-4"></span><span class="ResWord">static</span> <span class="ResWord">void</span> <span class="ID">noop</span>(<span class="ID">Counter</span> <span class="ID">c</span>) { ; }</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_16">  16</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_16"></span><span class="anchor" id="line-16-4"></span><span class="ResWord">static</span> <span class="ResWord">int</span> <span class="ID">return_zero</span>(<span class="ID">Counter</span> <span class="ID">c</span>) { <span class="ResWord">return</span> <span class="Number">0</span>; }</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_17">  17</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_17"></span><span class="anchor" id="line-17-3"></span><span class="ResWord">static</span> <span class="ResWord">struct</span> <span class="ID">counter</span> <span class="ID">Zero_counter</span> = { <span class="ID">noop</span>, <span class="ID">return_zero</span>, <span class="ID">noop</span> };</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_18">  18</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_18"></span><span class="anchor" id="line-18-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_19">  19</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_19"></span><span class="anchor" id="line-19-3"></span><span class="ID">Counter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_20">  20</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_20"></span><span class="anchor" id="line-20-3"></span><span class="ID">make_zero_counter</span>(<span class="ResWord">void</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_21">  21</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_21"></span><span class="anchor" id="line-21-3"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_22">  22</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_22"></span><span class="anchor" id="line-22-3"></span>    <span class="ResWord">return</span> &amp;<span class="ID">Zero_counter</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_23">  23</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_23"></span><span class="anchor" id="line-23-3"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_24">  24</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_24"></span><span class="anchor" id="line-24-3"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_25">  25</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_25"></span><span class="anchor" id="line-25-3"></span><span class="Comment">/* a fancier counter that iterates a function sequence */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_26">  26</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_26"></span><span class="anchor" id="line-26-3"></span><span class="Comment">/* this struct is not exported anywhere */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_27">  27</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_27"></span><span class="anchor" id="line-27-3"></span><span class="ResWord">struct</span> <span class="ID">ifs_counter</span> {</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_28">  28</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_28"></span><span class="anchor" id="line-28-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_29">  29</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_29"></span><span class="anchor" id="line-29-2"></span>    <span class="Comment">/* copied from struct counter declaration */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_30">  30</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_30"></span><span class="anchor" id="line-30-2"></span>    <span class="ID">COUNTER_FIELDS</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_31">  31</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_31"></span><span class="anchor" id="line-31-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_32">  32</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_32"></span><span class="anchor" id="line-32-2"></span>    <span class="Comment">/* new fields */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_33">  33</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_33"></span><span class="anchor" id="line-33-2"></span>    <span class="ResWord">int</span> <span class="ID">init</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_34">  34</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_34"></span><span class="anchor" id="line-34-2"></span>    <span class="ResWord">int</span> <span class="ID">cur</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_35">  35</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_35"></span><span class="anchor" id="line-35-2"></span>    <span class="ResWord">int</span> (*<span class="ID">f</span>)(<span class="ResWord">int</span>);      <span class="Comment">/* update rule */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_36">  36</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_36"></span><span class="anchor" id="line-36-2"></span>};</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_37">  37</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_37"></span><span class="anchor" id="line-37-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_38">  38</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_38"></span><span class="anchor" id="line-38-2"></span><span class="ResWord">static</span> <span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_39">  39</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_39"></span><span class="anchor" id="line-39-2"></span><span class="ID">ifs_reset</span>(<span class="ID">Counter</span> <span class="ID">c</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_40">  40</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_40"></span><span class="anchor" id="line-40-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_41">  41</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_41"></span><span class="anchor" id="line-41-2"></span>    <span class="ResWord">struct</span> <span class="ID">ifs_counter</span> *<span class="ID">ic</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_42">  42</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_42"></span><span class="anchor" id="line-42-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_43">  43</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_43"></span><span class="anchor" id="line-43-2"></span>    <span class="ID">ic</span> = (<span class="ResWord">struct</span> <span class="ID">ifs_counter</span> *) <span class="ID">c</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_44">  44</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_44"></span><span class="anchor" id="line-44-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_45">  45</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_45"></span><span class="anchor" id="line-45-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">cur</span> = <span class="ID">ic</span>-&gt;<span class="ID">init</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_46">  46</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_46"></span><span class="anchor" id="line-46-2"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_47">  47</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_47"></span><span class="anchor" id="line-47-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_48">  48</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_48"></span><span class="anchor" id="line-48-2"></span><span class="ResWord">static</span> <span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_49">  49</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_49"></span><span class="anchor" id="line-49-2"></span><span class="ID">ifs_next</span>(<span class="ID">Counter</span> <span class="ID">c</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_50">  50</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_50"></span><span class="anchor" id="line-50-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_51">  51</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_51"></span><span class="anchor" id="line-51-2"></span>    <span class="ResWord">struct</span> <span class="ID">ifs_counter</span> *<span class="ID">ic</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_52">  52</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_52"></span><span class="anchor" id="line-52-2"></span>    <span class="ResWord">int</span> <span class="ID">ret</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_53">  53</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_53"></span><span class="anchor" id="line-53-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_54">  54</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_54"></span><span class="anchor" id="line-54-2"></span>    <span class="ID">ic</span> = (<span class="ResWord">struct</span> <span class="ID">ifs_counter</span> *) <span class="ID">c</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_55">  55</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_55"></span><span class="anchor" id="line-55-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_56">  56</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_56"></span><span class="anchor" id="line-56-2"></span>    <span class="ID">ret</span> = <span class="ID">ic</span>-&gt;<span class="ID">cur</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_57">  57</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_57"></span><span class="anchor" id="line-57-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">cur</span> = <span class="ID">ic</span>-&gt;<span class="ID">f</span>(<span class="ID">ic</span>-&gt;<span class="ID">cur</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_58">  58</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_58"></span><span class="anchor" id="line-58-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_59">  59</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_59"></span><span class="anchor" id="line-59-2"></span>    <span class="ResWord">return</span> <span class="ID">ret</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_60">  60</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_60"></span><span class="anchor" id="line-60-2"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_61">  61</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_61"></span><span class="anchor" id="line-61-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_62">  62</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_62"></span><span class="anchor" id="line-62-2"></span><span class="ID">Counter</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_63">  63</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_63"></span><span class="anchor" id="line-63-2"></span><span class="ID">make_ifs_counter</span>(<span class="ResWord">int</span> <span class="ID">init</span>, <span class="ResWord">int</span> (*<span class="ID">f</span>)(<span class="ResWord">int</span>))</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_64">  64</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_64"></span><span class="anchor" id="line-64-2"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_65">  65</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_65"></span><span class="anchor" id="line-65-2"></span>    <span class="ResWord">struct</span> <span class="ID">ifs_counter</span> *<span class="ID">ic</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_66">  66</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_66"></span><span class="anchor" id="line-66-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_67">  67</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_67"></span><span class="anchor" id="line-67-2"></span>    <span class="ID">ic</span> = <span class="ID">malloc</span>(<span class="ResWord">sizeof</span>(*<span class="ID">ic</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_68">  68</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_68"></span><span class="anchor" id="line-68-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_69">  69</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_69"></span><span class="anchor" id="line-69-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">reset</span> = <span class="ID">ifs_reset</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_70">  70</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_70"></span><span class="anchor" id="line-70-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">next</span> = <span class="ID">ifs_next</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_71">  71</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_71"></span><span class="anchor" id="line-71-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">destroy</span> = (<span class="ResWord">void</span> (*)(<span class="ResWord">struct</span> <span class="ID">counter</span> *)) <span class="ID">free</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_72">  72</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_72"></span><span class="anchor" id="line-72-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_73">  73</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_73"></span><span class="anchor" id="line-73-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">init</span> = <span class="ID">init</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_74">  74</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_74"></span><span class="anchor" id="line-74-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">cur</span> = <span class="ID">init</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_75">  75</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_75"></span><span class="anchor" id="line-75-2"></span>    <span class="ID">ic</span>-&gt;<span class="ID">f</span> = <span class="ID">f</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_76">  76</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_76"></span><span class="anchor" id="line-76-2"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_77">  77</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_77"></span><span class="anchor" id="line-77-2"></span>    <span class="Comment">/* it's always a Counter on the outside */</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_78">  78</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_78"></span><span class="anchor" id="line-78-2"></span>    <span class="ResWord">return</span> (<span class="ID">Counter</span>) <span class="ID">ic</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-9118d7711627258636493d8a983c112bd7097149_79">  79</a> </span><span class="LineAnchor" id="CA-9118d7711627258636493d8a983c112bd7097149_79"></span><span class="anchor" id="line-79-2"></span>}</span>
</pre></div></div><span class="anchor" id="line-338"></span><span class="anchor" id="line-339"></span><p class="line874">A typical use might be <span class="anchor" id="line-340"></span><span class="anchor" id="line-341"></span></p><p class="line867"><span class="anchor" id="line-342"></span><span class="anchor" id="line-343"></span><span class="anchor" id="line-344"></span><span class="anchor" id="line-345"></span><span class="anchor" id="line-346"></span><span class="anchor" id="line-347"></span><span class="anchor" id="line-348"></span><span class="anchor" id="line-349"></span><span class="anchor" id="line-350"></span><span class="anchor" id="line-351"></span><span class="anchor" id="line-352"></span><span class="anchor" id="line-353"></span><span class="anchor" id="line-354"></span><span class="anchor" id="line-355"></span><span class="anchor" id="line-356"></span><span class="anchor" id="line-357"></span><span class="anchor" id="line-358"></span><span class="anchor" id="line-359"></span><span class="anchor" id="line-360"></span><span class="anchor" id="line-361"></span><span class="anchor" id="line-362"></span><span class="anchor" id="line-363"></span><span class="anchor" id="line-364"></span><span class="anchor" id="line-365"></span><span class="anchor" id="line-366"></span><span class="anchor" id="line-367"></span><span class="anchor" id="line-368"></span><span class="anchor" id="line-1-15"></span></p><div class="highlight cpp"><div class="codearea" dir="ltr" lang="en">
<script type="text/javascript">
document.write('<a href="#" onclick="return togglenumber(\'CA-38cca2819d4074c674cfaea7568572f14dab324a\', 1, 1);" \
                class="codenumbers">Toggle line numbers<\/a>');
</script><a href="#" onclick="return togglenumber('CA-38cca2819d4074c674cfaea7568572f14dab324a', 1, 1);" class="codenumbers">Toggle line numbers</a>
<pre dir="ltr" id="CA-38cca2819d4074c674cfaea7568572f14dab324a" lang="en"><span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_1">   1</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_1"></span><span class="anchor" id="line-1-16"></span><span class="ResWord">static</span> <span class="ResWord">int</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_2">   2</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_2"></span><span class="anchor" id="line-2-8"></span><span class="ID">times2</span>(<span class="ResWord">int</span> <span class="ID">x</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_3">   3</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_3"></span><span class="anchor" id="line-3-8"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_4">   4</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_4"></span><span class="anchor" id="line-4-7"></span>    <span class="ResWord">return</span> <span class="ID">x</span>*<span class="Number">2</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_5">   5</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_5"></span><span class="anchor" id="line-5-7"></span>}</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_6">   6</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_6"></span><span class="anchor" id="line-6-6"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_7">   7</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_7"></span><span class="anchor" id="line-7-6"></span><span class="ResWord">void</span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_8">   8</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_8"></span><span class="anchor" id="line-8-6"></span><span class="ID">print_powers_of_2</span>(<span class="ResWord">void</span>)</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_9">   9</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_9"></span><span class="anchor" id="line-9-6"></span>{</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_10">  10</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_10"></span><span class="anchor" id="line-10-6"></span>    <span class="ResWord">int</span> <span class="ID">i</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_11">  11</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_11"></span><span class="anchor" id="line-11-6"></span>    <span class="ID">Counter</span> <span class="ID">c</span>;</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_12">  12</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_12"></span><span class="anchor" id="line-12-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_13">  13</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_13"></span><span class="anchor" id="line-13-5"></span>    <span class="ID">c</span> = <span class="ID">make_ifs_counter</span>(<span class="Number">1</span>, <span class="ID">times2</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_14">  14</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_14"></span><span class="anchor" id="line-14-5"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_15">  15</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_15"></span><span class="anchor" id="line-15-5"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="Number">10</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_16">  16</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_16"></span><span class="anchor" id="line-16-5"></span>        <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, <span class="ID">c</span>-&gt;<span class="ID">next</span>(<span class="ID">c</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_17">  17</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_17"></span><span class="anchor" id="line-17-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_18">  18</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_18"></span><span class="anchor" id="line-18-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_19">  19</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_19"></span><span class="anchor" id="line-19-4"></span>    <span class="ID">c</span>-&gt;<span class="ID">reset</span>(<span class="ID">c</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_20">  20</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_20"></span><span class="anchor" id="line-20-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_21">  21</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_21"></span><span class="anchor" id="line-21-4"></span>    <span class="ResWord">for</span>(<span class="ID">i</span> = <span class="Number">0</span>; <span class="ID">i</span> &lt; <span class="Number">20</span>; <span class="ID">i</span>++) {</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_22">  22</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_22"></span><span class="anchor" id="line-22-4"></span>        <span class="ID">printf</span>(<span class="String">"</span><span class="String">%d</span><span class="SPChar">\n</span><span class="String">"</span>, <span class="ID">c</span>-&gt;<span class="ID">next</span>(<span class="ID">c</span>));</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_23">  23</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_23"></span><span class="anchor" id="line-23-4"></span>    }</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_24">  24</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_24"></span><span class="anchor" id="line-24-4"></span></span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_25">  25</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_25"></span><span class="anchor" id="line-25-4"></span>    <span class="ID">c</span>-&gt;<span class="ID">destroy</span>(<span class="ID">c</span>);</span>
<span class="line"><span class="LineNumber"><a href="#CA-38cca2819d4074c674cfaea7568572f14dab324a_26">  26</a> </span><span class="LineAnchor" id="CA-38cca2819d4074c674cfaea7568572f14dab324a_26"></span><span class="anchor" id="line-26-4"></span>}</span>
</pre></div></div><span class="anchor" id="line-369"></span><span class="anchor" id="line-370"></span><p class="line867"></p><hr><p class="line874"> <span class="anchor" id="line-371"></span><a href="http://www.cs.yale.edu/homes/aspnes/pinewiki/CategoryProgrammingNotes.html">CategoryProgrammingNotes</a> <span class="anchor" id="line-372"></span><span class="anchor" id="bottom"></span></p></div>
</div>
<hr>
2014-06-17 11:57


</body></html>